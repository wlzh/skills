# 发票识别 Skill

自动识别所有类型的发票（交通、住宿、餐饮等），提取关键信息并生成分类统计报告。

## 功能特性

- 🔍 **全面识别** - 识别市内交通、长途交通、住宿、餐饮等所有类型发票
- 📂 **智能分类** - 自动按四大类别分类统计
- 📦 **支持 ZIP** - 可以直接处理压缩包
- 🤖 **自动解压** - 自动检测并解压目录中的 ZIP 文件到同级目录
- 📊 **双格式输出** - JSON（程序处理）+ Markdown（人类阅读）
- 🎯 **精准提取** - 提取日期、金额、行程等关键信息
- 💰 **自动统计** - 计算总金额和分类汇总
- 🔄 **去重处理** - 自动识别重复发票（如行程单+电子发票）

## 使用方法

### 基本用法

```bash
# 扫描指定目录
/invoice-scanner ./发票文件夹

# 扫描 ZIP 文件
/invoice-scanner ./receipts.zip

# 扫描当前目录
/invoice-scanner .

# 扫描包含 ZIP 文件的目录（自动解压）
# 如果目录中有 ZIP 文件，会自动解压并识别所有发票
/invoice-scanner ./mixed-invoices
```

### 自动解压功能

当扫描目录时，skill 会自动：
1. 检测目录中的所有 `.zip` 文件
2. 将每个 ZIP 解压到同名文件夹（如 `发票.zip` → `发票/` 目录）
3. 扫描原始文件 + 解压后的文件
4. 生成统一的识别报告

示例：
```
发票文件夹/
├── 交通费.zip          ← 自动解压
│   ├── 打车1.jpg
│   └── 地铁票.png
├── 酒店发票.pdf        ← 直接识别
└── 餐饮.zip            ← 自动解压
    └── 晚餐.jpg
```

## 支持的发票类型

### 📍 市内交通
- 打车发票（滴滴、出租车、网约车等）
- 地铁票、公交票

### ✈️ 长途交通
- 飞机票（机票行程单、电子客票行程单）
- 火车票（高铁、动车、普通列车）
- 长途汽车票

### 🏨 住宿
- 酒店住宿发票
- 酒店结账单
- 增值税专用发票（住宿服务）

### 📦 其他
- 餐饮发票
- 通讯费发票
- 办公用品、快递等其他消费

### 支持的文件格式

- 图片：`.jpg`, `.jpeg`, `.png`
- 文档：`.pdf`
- 压缩包：`.zip`

## 输出结果

执行后会在当前目录生成两个文件：

### 1. `invoices.json` - 结构化数据

```json
{
  "scan_date": "2026-01-10",
  "total_count": 15,
  "total_amount": 8430.50,
  "summary_by_category": {
    "市内交通": {
      "count": 5,
      "amount": 230.00,
      "types": {"打车": 4, "地铁": 1}
    },
    "长途交通": {
      "count": 4,
      "amount": 3600.00,
      "types": {"飞机票": 2, "火车票": 2}
    },
    "住宿": {
      "count": 2,
      "amount": 4200.00
    },
    "其他": {
      "count": 4,
      "amount": 400.50,
      "types": {"餐饮": 3, "通讯": 1}
    }
  },
  "invoices": [
    {
      "category": "长途交通",
      "type": "飞机票",
      "passenger": "张三",
      "from": "北京首都机场",
      "to": "上海虹桥机场",
      "date": "2025-12-15",
      "amount": 1200.00,
      "file": "receipt_001.jpg"
    },
    {
      "category": "住宿",
      "type": "酒店发票",
      "hotel_name": "如家酒店",
      "guest_name": "张三",
      "check_in": "2025-12-15",
      "check_out": "2025-12-17",
      "nights": 2,
      "amount": 580.00,
      "file": "hotel_001.pdf"
    }
  ]
}
```

### 2. `invoices.md` - 可读性报告

包含：
- 📊 统计汇总（总金额、四大分类的数量和金额）
- 📋 分类表格（市内交通/长途交通/住宿/其他）
- 🔍 详细信息列表
- ❗ 未识别文件列表（含原因说明）

## 应用场景

- 💼 **差旅报销** - 自动整理出差所有费用（交通、住宿、餐饮）
- 📝 **财务统计** - 快速汇总各类费用，按类别分析
- 🗂️ **发票归档** - 结构化存储所有发票信息
- 📊 **数据分析** - 导出 JSON 用于财务系统对接
- 🏢 **企业报销** - 提供完整的报销单据清单

## 技术原理

使用 Claude 的多模态能力直接识别图片中的文字和结构：
1. 读取图片/PDF 文件
2. AI 视觉分析判断发票类型和分类
3. 提取关键字段信息
4. 智能去重（识别重复发票）
5. 生成结构化报告

## 注意事项

- 确保发票图片清晰可读
- 支持中文发票（国内航班、火车、打车平台、酒店、餐饮等）
- 自动识别并避免重复发票（如行程单+对应电子发票）
- 对于无法识别的图片会在报告中标注原因
- ZIP 文件处理：
  - 直接指定 ZIP 文件：解压到临时目录，处理完成后自动清理
  - 目录中包含 ZIP：自动检测并解压到同级目录，解压后的文件保留
  - 解压前检查是否已存在同名目录，避免覆盖数据
- 非正式发票（如支付截图、转账记录）会单独列出，不计入统计

## 示例输出

```
✅ 发票扫描完成

📊 统计摘要：
- 总计: 15 张发票
- 总金额: ¥8,430.50

按分类统计：
📍 市内交通: 5 张 (¥230.00)
  - 打车: 4 张 (¥210.00)
  - 地铁: 1 张 (¥20.00)

✈️ 长途交通: 4 张 (¥3,600.00)
  - 飞机票: 2 张 (¥2,400.00)
  - 火车票: 2 张 (¥1,200.00)

🏨 住宿: 2 张 (¥4,200.00)

📦 其他: 4 张 (¥400.50)
  - 餐饮: 3 张 (¥350.50)
  - 通讯: 1 张 (¥50.00)

📄 报告已生成：
- invoices.json (结构化数据)
- invoices.md (可读性报告)
```

## 版本信息

- 版本: 2.1.0
- 支持的发票类型:
  - 市内交通（打车、地铁、公交）
  - 长途交通（飞机票、火车票、长途汽车）
  - 住宿（酒店发票、结账单）
  - 其他（餐饮、通讯、办公用品等）
- 输出格式: JSON + Markdown
- 新增功能:
  - ✨ 自动检测并解压目录中的 ZIP 文件
  - 智能分类、去重处理、全类型识别
